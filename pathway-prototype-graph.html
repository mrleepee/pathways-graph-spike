<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>TRAF6 Pathway — ECharts Graph</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- ECharts CDN -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        }

        .app {
            display: grid;
            grid-template-rows: auto 1fr;
            height: 100%;
        }

        .panel {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
            padding: 10px 14px;
            border-bottom: 1px solid #eee;
            background: #fafafa;
        }

        .group {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .group label {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }

        #chart {
            width: 100%;
            height: calc(100vh - 60px);
        }

        .badge {
            border-radius: 999px;
            padding: 2px 8px;
            font-size: 12px;
            border: 1px solid #ddd;
            background: #fff;
        }
    </style>
</head>

<body>
    <div class="app">
        <div class="panel">
            <div class="group">
                <strong>Edge filters:</strong>
                <label><input type="checkbox" class="rel" value="participatesIn" checked /> participatesIn</label>
                <label><input type="checkbox" class="rel" value="hasParticipant" checked /> hasParticipant</label>
                <label><input type="checkbox" class="rel" value="upstreamOf" checked /> upstreamOf</label>
                <label><input type="checkbox" class="rel" value="activates" checked /> activates</label>
                <label><input type="checkbox" class="rel" value="ubiquitinates" checked /> ubiquitinates</label>
                <label><input type="checkbox" class="rel" value="scaffolds" checked /> scaffolds</label>
                <label><input type="checkbox" class="rel" value="leadsTo" checked /> leadsTo</label>
                <label><input type="checkbox" class="rel" value="resultsIn" checked /> resultsIn</label>
                <label><input type="checkbox" class="rel" value="narrower" checked /> narrower</label>
            </div>
            <div class="group">
                <span class="badge">Drag nodes; wheel to zoom. Click to focus neighborhood.</span>
            </div>
        </div>
        <div id="chart"></div>
    </div>

    <script>
        (function () {
            const categories = [
                { name: 'Pathway', symbol: 'roundRect' },
                { name: 'Protein', symbol: 'circle' },
                { name: 'Complex', symbol: 'diamond' },
                { name: 'Event', symbol: 'pin' }
            ];
            const catIndex = Object.fromEntries(categories.map((c, i) => [c.name, i]));

            // Nodes (from your TTL model)
            const nodes = [
                // Pathways (SKOS concepts)
                N('PRR_Signaling', 'Pattern Recognition Receptor (PRR) signaling', 'Pathway', 'Root of PRR signaling.'),
                N('TLR_Signaling', 'Toll-like receptor signaling', 'Pathway', 'Parent of TLR branches.'),
                N('TLR1_TLR2_Pathway', 'TLR1:TLR2 (MyD88-dependent) signaling', 'Pathway',
                    'Bacterial triacylated lipoproteins → TIRAP/MyD88 → IRAK4/1 → TRAF6 (K63-Ub) → TAK1 → IKK/NF-κB, MAPK.'),
                N('TLR4_Pathway', 'TLR4 (MyD88/TRIF) signaling', 'Pathway'),
                N('IL1R_Pathway', 'IL-1 receptor (MyD88) signaling', 'Pathway'),
                N('RANKL_Pathway', 'RANKL/RANK signaling', 'Pathway'),
                N('CD40_Pathway', 'CD40 signaling', 'Pathway'),
                N('NFKB_Pathway', 'NF-κB canonical pathway', 'Pathway'),
                N('MAPK_Pathway', 'MAPK (JNK/p38) cascades', 'Pathway'),

                // Proteins
                N('TRAF6', 'TRAF6', 'Protein', 'Adaptor/E3 ligase hub (K63-Ub).'),
                N('TLR1', 'TLR1', 'Protein'),
                N('TLR2', 'TLR2', 'Protein'),
                N('TIRAP', 'TIRAP/MAL', 'Protein', 'Membrane adaptor.'),
                N('MyD88', 'MyD88', 'Protein', 'Core adaptor.'),
                N('IRAK4', 'IRAK4', 'Protein', 'Ser/Thr kinase.'),
                N('IRAK1', 'IRAK1', 'Protein', 'Ser/Thr kinase.'),
                N('TAK1', 'TAK1 (MAP3K7)', 'Protein', 'MAP3K activating NF-κB/MAPK.'),
                N('TAB1', 'TAB1', 'Protein'),
                N('TAB2', 'TAB2', 'Protein', 'Scaffold reads K63-Ub.'),
                N('TAB3', 'TAB3', 'Protein', 'Scaffold reads K63-Ub.'),
                N('IKKalpha', 'IKKα (CHUK)', 'Protein'),
                N('IKKbeta', 'IKKβ (IKBKB)', 'Protein'),
                N('NEMO', 'NEMO (IKBKG)', 'Protein'),
                N('RELA', 'RelA/p65', 'Protein', 'NF-κB subunit.'),
                N('NFKB1', 'NF-κB1/p50', 'Protein', 'NF-κB subunit.'),

                // Complexes
                N('TLR1_TLR2_Complex', 'TLR1:TLR2 heterodimer', 'Complex'),
                N('IKK_Complex', 'IKK complex (IKKα/IKKβ/NEMO)', 'Complex'),
                N('NFKB_p50_p65', 'NF-κB p50:p65', 'Complex'),

                // Events
                N('ProInflammatoryCytokines', '↑ TNFα, IL-6, IL-1β', 'Event'),
                N('TranscriptionalActivation', 'NF-κB target activation', 'Event'),
                N('AP1_Dependent_Transcription', 'AP-1 target activation', 'Event')
            ];

            // Links with relation types (edge filtering uses `relation`)
            const links = [
                // SKOS hierarchy (broader → narrower)
                L('PRR_Signaling', 'TLR_Signaling', 'narrower'),
                L('TLR_Signaling', 'TLR1_TLR2_Pathway', 'narrower'),
                L('TLR_Signaling', 'TLR4_Pathway', 'narrower'),

                // Pathway participation
                L('TLR1', 'TLR1_TLR2_Pathway', 'participatesIn'),
                L('TLR2', 'TLR1_TLR2_Pathway', 'participatesIn'),
                L('TIRAP', 'TLR1_TLR2_Pathway', 'participatesIn'),
                L('MyD88', 'TLR1_TLR2_Pathway', 'participatesIn'),
                L('IRAK4', 'TLR1_TLR2_Pathway', 'participatesIn'),
                L('IRAK1', 'TLR1_TLR2_Pathway', 'participatesIn'),
                L('TRAF6', 'TLR1_TLR2_Pathway', 'participatesIn'),
                L('TAK1', 'TLR1_TLR2_Pathway', 'participatesIn'),
                L('TAB1', 'TLR1_TLR2_Pathway', 'participatesIn'),
                L('TAB2', 'TLR1_TLR2_Pathway', 'participatesIn'),
                L('TAB3', 'TLR1_TLR2_Pathway', 'participatesIn'),

                // Cross-pathway convergence on TRAF6
                L('MyD88', 'IL1R_Pathway', 'participatesIn'),
                L('IRAK4', 'IL1R_Pathway', 'participatesIn'),
                L('IRAK1', 'IL1R_Pathway', 'participatesIn'),
                L('TRAF6', 'IL1R_Pathway', 'participatesIn'),
                L('TRAF6', 'RANKL_Pathway', 'participatesIn'),
                L('TRAF6', 'CD40_Pathway', 'participatesIn'),

                // NF-κB membership
                L('IKKalpha', 'NFKB_Pathway', 'participatesIn'),
                L('IKKbeta', 'NFKB_Pathway', 'participatesIn'),
                L('NEMO', 'NFKB_Pathway', 'participatesIn'),
                L('RELA', 'NFKB_Pathway', 'participatesIn'),
                L('NFKB1', 'NFKB_Pathway', 'participatesIn'),

                // Complex composition
                L('IKK_Complex', 'IKKalpha', 'hasParticipant'),
                L('IKK_Complex', 'IKKbeta', 'hasParticipant'),
                L('IKK_Complex', 'NEMO', 'hasParticipant'),
                L('NFKB_p50_p65', 'RELA', 'hasParticipant'),
                L('NFKB_p50_p65', 'NFKB1', 'hasParticipant'),

                // Complex → pathway embedding
                L('IKK_Complex', 'NFKB_Pathway', 'participatesIn'),
                L('TLR1_TLR2_Complex', 'TLR1_TLR2_Pathway', 'participatesIn'),

                // Causal chain (upstreamOf)
                L('TLR1', 'TIRAP', 'upstreamOf'),
                L('TLR2', 'TIRAP', 'upstreamOf'),
                L('TIRAP', 'MyD88', 'upstreamOf'),
                L('MyD88', 'IRAK4', 'upstreamOf'),
                L('IRAK4', 'IRAK1', 'upstreamOf'),
                L('IRAK1', 'TRAF6', 'upstreamOf'),
                L('TRAF6', 'TAK1', 'upstreamOf'),
                L('TAK1', 'IKKalpha', 'upstreamOf'),
                L('TAK1', 'IKKbeta', 'upstreamOf'),
                L('TAK1', 'NEMO', 'upstreamOf'),

                // Mechanistic edges
                L('TRAF6', 'TAK1', 'ubiquitinates'),
                L('TAB2', 'TAK1', 'scaffolds'),
                L('TAB3', 'TAK1', 'scaffolds'),
                L('TAK1', 'IKKalpha', 'activates'),
                L('TAK1', 'IKKbeta', 'activates'),
                L('TAK1', 'NEMO', 'activates'),

                // Pathway transitions & outcomes
                L('TLR1_TLR2_Pathway', 'NFKB_Pathway', 'leadsTo'),
                L('TLR1_TLR2_Pathway', 'MAPK_Pathway', 'leadsTo'),
                L('IL1R_Pathway', 'NFKB_Pathway', 'leadsTo'),
                L('IL1R_Pathway', 'MAPK_Pathway', 'leadsTo'),
                L('RANKL_Pathway', 'NFKB_Pathway', 'leadsTo'),
                L('CD40_Pathway', 'NFKB_Pathway', 'leadsTo'),

                L('TLR1_TLR2_Pathway', 'ProInflammatoryCytokines', 'resultsIn'),
                L('NFKB_Pathway', 'TranscriptionalActivation', 'resultsIn'),
                L('MAPK_Pathway', 'AP1_Dependent_Transcription', 'resultsIn')
            ];

            // Relation-specific visuals
            const relationStyles = {
                participatesIn: { type: 'solid', curveness: 0.0, width: 1.5, symbol: ['none', 'arrow'] },
                hasParticipant: { type: 'dotted', curveness: 0.1, width: 1.2, symbol: ['circle', 'arrow'] },
                upstreamOf: { type: 'solid', curveness: 0.05, width: 2.0, symbol: ['none', 'arrow'] },
                activates: { type: 'solid', curveness: 0.15, width: 2.2, symbol: ['none', 'arrow'] },
                ubiquitinates: { type: 'dashed', curveness: 0.2, width: 2.2, symbol: ['diamond', 'arrow'] },
                scaffolds: { type: 'dashed', curveness: 0.2, width: 1.8, symbol: ['rect', 'arrow'] },
                leadsTo: { type: 'solid', curveness: 0.25, width: 2.0, symbol: ['none', 'arrow'] },
                resultsIn: { type: 'dotted', curveness: 0.25, width: 1.8, symbol: ['circle', 'arrow'] },
                narrower: { type: 'solid', curveness: 0.0, width: 1.5, symbol: ['none', 'arrow'] }
            };

            // Build ECharts option
            const chart = echarts.init(document.getElementById('chart'));
            function render() {
                const enabled = new Set(getEnabledRelations());
                const filteredLinks = links.filter(l => enabled.has(l.relation)).map(styleLink);

                const option = {
                    tooltip: {
                        trigger: 'item',
                        formatter: (p) => {
                            if (p.dataType === 'node') {
                                const d = p.data;
                                return `<strong>${e(d.name)}</strong><br/>Type: ${e(d.categoryName)}${d.desc ? `<br/>${e(d.desc)}` : ''}`;
                            } else {
                                const d = p.data;
                                return `<em>${e(d.relation)}</em><br/>${e(d.source)} ➜ ${e(d.target)}`;
                            }
                        }
                    },
                    legend: [{ data: categories.map(c => c.name) }],
                    toolbox: { feature: { restore: {}, saveAsImage: {} } },
                    series: [{
                        type: 'graph',
                        layout: 'force',
                        roam: true,
                        draggable: true,
                        focusNodeAdjacency: true,
                        animationDuration: 500,
                        animationEasingUpdate: 'quarticInOut',
                        categories: categories.map(c => ({ name: c.name, symbol: c.symbol })),
                        data: nodes.map(n => ({
                            id: n.id,
                            name: n.name,
                            value: n.id,
                            category: catIndex[n.category],
                            categoryName: n.category,
                            symbol: categories[catIndex[n.category]].symbol,
                            symbolSize: sizeFor(n.category),
                            desc: n.desc
                        })),
                        links: filteredLinks,
                        lineStyle: { opacity: 0.9 },
                        label: { show: true, position: 'right', fontSize: 12 },
                        force: { repulsion: 1000, edgeLength: [80, 180], friction: 0.2, gravity: 0.1 },
                        edgeLabel: { show: true, formatter: params => params.data.relation, fontSize: 10 }
                    }]
                };
                chart.setOption(option);
            }

            // Helpers
            function N(id, name, category, desc = '') { return { id, name, category, desc }; }
            function L(source, target, relation) { return { source, target, relation }; }
            function sizeFor(category) {
                switch (category) {
                    case 'Pathway': return 60;
                    case 'Protein': return 38;
                    case 'Complex': return 46;
                    case 'Event': return 30;
                    default: return 32;
                }
            }
            function styleLink(link) {
                const s = relationStyles[link.relation] || relationStyles.participatesIn;
                return {
                    ...link,
                    lineStyle: { type: s.type, width: s.width, curveness: s.curveness },
                    edgeSymbol: s.symbol,
                    edgeSymbolSize: [6, 12]
                };
            }
            function getEnabledRelations() {
                return Array.from(document.querySelectorAll('.rel')).filter(cb => cb.checked).map(cb => cb.value);
            }
            function e(s) { return String(s).replace(/[&<>"]/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;' }[c])); }

            // UI wiring
            document.querySelectorAll('.rel').forEach(cb => cb.addEventListener('change', render));
            window.addEventListener('resize', () => chart.resize());
            render();
        })();
    </script>
</body>

</html>